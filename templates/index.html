<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>80天減重計畫</title>
    <!-- Google Fonts: Poppins + Open Sans -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <header>
        <h1>80 天減重計畫</h1>
        <p class="subtitle"><span id="startWeight">119</span> kg → <span id="targetWeight">99</span> kg | 目標減重 20 公斤</p>
    </header>

    <nav>
        <button class="nav-btn active" data-tab="overview">總覽</button>
        <button class="nav-btn" data-tab="daily">每日計畫</button>
        <button class="nav-btn" data-tab="menu">菜單</button>
        <button class="nav-btn" data-tab="shopping">採買清單</button>
        <button class="nav-btn" data-tab="tracker">追蹤表</button>
    </nav>

    <main>
        <!-- 總覽 -->
        <section id="overview" class="tab-content active">
            <div class="card">
                <h2>營養目標</h2>
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-value" id="bmrValue">2300</span>
                        <span class="stat-label">基礎代謝 kcal</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="caloriesRange">1800-2200</span>
                        <span class="stat-label">每日攝取 kcal</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="proteinTarget">180-220</span>
                        <span class="stat-label">蛋白質目標 g</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">MARS</span>
                        <span class="stat-label" id="wheyInfo">水解乳清 35g/包</span>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>階段總覽</h2>
                <table>
                    <thead>
                        <tr>
                            <th>階段</th>
                            <th>天數</th>
                            <th>重點</th>
                            <th>預期減重</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>第一階段</td>
                            <td>Day 1-14</td>
                            <td>適應期：建立習慣</td>
                            <td>2-3 kg</td>
                        </tr>
                        <tr>
                            <td>第二階段</td>
                            <td>Day 15-42</td>
                            <td>燃脂期：穩定執行</td>
                            <td>7-9 kg</td>
                        </tr>
                        <tr>
                            <td>第三階段</td>
                            <td>Day 43-80</td>
                            <td>衝刺期：最大化燃脂</td>
                            <td>15-20 kg</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="card">
                <h2>運動參數（適應期）
                    <button class="btn-add" onclick="showExerciseModal()">+ 新增</button>
                </h2>
                <table>
                    <thead>
                        <tr>
                            <th>運動類型</th>
                            <th>時間</th>
                            <th>速率/強度</th>
                            <th>預估距離</th>
                            <th>預估消耗</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="exerciseTable">
                        <tr><td colspan="6" class="loading">載入中...</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- 每日計畫 -->
        <section id="daily" class="tab-content">
            <div class="card">
                <h2>選擇日期</h2>
                <div class="day-selector">
                    <label for="currentDay">目前是第幾天：</label>
                    <input type="number" id="currentDay" min="1" max="80" value="1">
                    <button id="showDayBtn" class="btn-primary">顯示計畫</button>
                </div>
            </div>

            <div class="card">
                <h2>Day <span id="dayNumber">1</span>（<span id="dayOfWeek">週一</span>）</h2>
                <table>
                    <thead>
                        <tr>
                            <th>時間</th>
                            <th>項目</th>
                            <th>內容</th>
                        </tr>
                    </thead>
                    <tbody id="dailySchedule">
                    </tbody>
                </table>
            </div>

            <div class="card">
                <h2>每日檢查清單</h2>
                <div class="checklist">
                    <h3>早上</h3>
                    <label class="check-item"><input type="checkbox" data-key="morning-1"> 量體重並記錄</label>
                    <label class="check-item"><input type="checkbox" data-key="morning-2"> 喝水 500ml</label>
                    <label class="check-item"><input type="checkbox" data-key="morning-coffee"> 喝黑咖啡</label>
                    <label class="check-item"><input type="checkbox" data-key="morning-3"> 吃早餐（高蛋白）</label>

                    <h3>中午</h3>
                    <label class="check-item"><input type="checkbox" data-key="noon-1"> 吃午餐（含碳水）</label>
                    <label class="check-item"><input type="checkbox" data-key="noon-2"> 飯後散步 30 分鐘</label>

                    <h3>下午</h3>
                    <label class="check-item"><input type="checkbox" data-key="afternoon-1"> 完成下午有氧</label>
                    <label class="check-item"><input type="checkbox" data-key="afternoon-2"> 收操走路 20-30 分鐘</label>

                    <h3>晚上</h3>
                    <label class="check-item"><input type="checkbox" data-key="evening-1"> 吃晚餐（低碳）</label>
                    <label class="check-item"><input type="checkbox" data-key="evening-2"> 完成晚間有氧</label>
                    <label class="check-item"><input type="checkbox" data-key="evening-3"> 23:30 前就寢</label>

                    <h3>每日必達</h3>
                    <label class="check-item"><input type="checkbox" data-key="daily-1"> 喝水 2000-3000ml</label>
                    <label class="check-item"><input type="checkbox" data-key="daily-2"> 蛋白質攝取 180g 以上</label>
                    <label class="check-item"><input type="checkbox" data-key="daily-3"> 睡眠 7-8 小時</label>
                </div>
            </div>
        </section>

        <!-- 菜單 -->
        <section id="menu" class="tab-content">
            <div class="card today-meals-card">
                <h2>今日飲食記錄</h2>
                <p class="hint">點擊下方菜單卡片即可記錄今天吃了什麼</p>
                <div id="todayMealsSummary">
                    <p class="no-record">今日尚未記錄任何餐點</p>
                </div>
            </div>

            <div class="card">
                <h2>早餐選項（450-600 kcal）
                    <button class="btn-add" onclick="showMealModal('breakfast')">+ 新增</button>
                </h2>
                <div class="menu-grid" id="breakfastGrid">
                    <div class="loading">載入中...</div>
                </div>
            </div>

            <div class="card">
                <h2>午餐選項（650-800 kcal）
                    <button class="btn-add" onclick="showMealModal('lunch')">+ 新增</button>
                </h2>
                <div class="menu-grid" id="lunchGrid">
                    <div class="loading">載入中...</div>
                </div>
            </div>

            <div class="card">
                <h2>晚餐選項（550-750 kcal）
                    <button class="btn-add" onclick="showMealModal('dinner')">+ 新增</button>
                </h2>
                <div class="menu-grid" id="dinnerGrid">
                    <div class="loading">載入中...</div>
                </div>
            </div>
        </section>

        <!-- 採買清單 -->
        <section id="shopping" class="tab-content">
            <div id="shoppingList">
                <div class="loading">載入中...</div>
            </div>
        </section>

        <!-- 追蹤表 -->
        <section id="tracker" class="tab-content">
            <div class="card">
                <h2>飲食記錄歷史</h2>
                <div id="mealHistoryContainer">
                    <div class="loading">載入中...</div>
                </div>
            </div>

            <div class="card">
                <h2>體重追蹤</h2>
                <div class="weight-input">
                    <label for="todayWeight">今日體重（kg）：</label>
                    <input type="number" id="todayWeight" step="0.1" min="50" max="200">
                    <button id="saveWeightBtn" class="btn-primary">記錄</button>
                </div>
                <div class="chart-container">
                    <canvas id="weightCanvas"></canvas>
                </div>
            </div>

            <div class="card">
                <h2>體重記錄表</h2>
                <table id="weightTable">
                    <thead>
                        <tr>
                            <th>日期</th>
                            <th>Day</th>
                            <th>體重 (kg)</th>
                            <th>變化</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td colspan="5" class="loading">載入中...</td></tr>
                    </tbody>
                </table>
            </div>

            <div class="card">
                <h2>統計資料</h2>
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-value">119</span>
                        <span class="stat-label">起始體重 kg</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="currentWeightVal">--</span>
                        <span class="stat-label">目前體重 kg</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="totalLost">--</span>
                        <span class="stat-label">累計減重 kg</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="targetRemaining">--</span>
                        <span class="stat-label">距離目標 kg</span>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- 菜單 Modal -->
    <div class="modal" id="mealModal">
        <div class="modal-content">
            <h3 id="mealModalTitle">新增菜單</h3>
            <form id="mealForm" onsubmit="event.preventDefault(); saveMeal();">
                <input type="hidden" id="mealId">
                <div class="form-group">
                    <label>餐別</label>
                    <select id="mealType" required>
                        <option value="breakfast">早餐</option>
                        <option value="lunch">午餐</option>
                        <option value="dinner">晚餐</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>名稱</label>
                    <input type="text" id="mealName" required>
                </div>
                <div class="form-group">
                    <label>食材（用逗號分隔）</label>
                    <textarea id="mealIngredients" placeholder="例：雞胸肉 350g, 青花菜 250g, 糙米飯 180g"></textarea>
                </div>
                <div class="form-group">
                    <label>熱量 (kcal)</label>
                    <input type="number" id="mealCalories" required>
                </div>
                <div class="form-group">
                    <label>蛋白質 (g)</label>
                    <input type="number" id="mealProtein" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeMealModal()">取消</button>
                    <button type="submit" class="btn-primary">儲存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 採買 Modal -->
    <div class="modal" id="shoppingModal">
        <div class="modal-content">
            <h3 id="shoppingModalTitle">新增採買項目</h3>
            <form id="shoppingForm" onsubmit="event.preventDefault(); saveShoppingItem();">
                <input type="hidden" id="shoppingId">
                <div class="form-group">
                    <label>類別</label>
                    <select id="shoppingCategory" required>
                        <option value="protein">蛋白質來源</option>
                        <option value="vegetable">蔬菜類</option>
                        <option value="carb">碳水化合物</option>
                        <option value="oil">健康油脂</option>
                        <option value="supplement">補充品</option>
                        <option value="drink">飲品</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>品項名稱</label>
                    <input type="text" id="shoppingName" required>
                </div>
                <div class="form-group">
                    <label>品牌/廠商</label>
                    <input type="text" id="shoppingBrand" placeholder="例：卜蜂、Kirkland">
                </div>
                <div class="form-group">
                    <label>規格</label>
                    <input type="text" id="shoppingSpec" placeholder="例：2.5kg/包（冷凍區）">
                </div>
                <div class="form-group">
                    <label>參考價格</label>
                    <input type="text" id="shoppingPrice" placeholder="例：NT$ 350-400">
                </div>
                <div class="form-group">
                    <label>每週建議量</label>
                    <input type="text" id="shoppingAmount" placeholder="例：3包">
                </div>
                <div class="form-group">
                    <label>備註</label>
                    <input type="text" id="shoppingNote">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeShoppingModal()">取消</button>
                    <button type="submit" class="btn-primary">儲存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast"></div>

    <footer>
        <p>80 天減重計畫 | Flask + SQLite 版本</p>
    </footer>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script>
        // Initialize Lucide icons
        lucide.createIcons();
    </script>
</body>
</html>
